<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Noisy planets</title>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="lib/bootstrap-4.5.3-dist/css/bootstrap.min.css">

    <!--    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400&display=swap" rel="stylesheet">-->

    <link rel="stylesheet" href="style.css"/>
</head>
<body>
<div class="container np-container">
    <h1 class="display-4">Noisy planets</h1>

    <canvas id="canvas" class="np-canvas"></canvas>

    <hr/>
    <h3>Settings</h3>

    <div class="row mb-3">
        <div class="col-4">
            <strong>Number of lines</strong><br/>
            <small></small>
        </div>
        <div class="col-8">
            <input type="number"
                   class="form-control"
                   id="setting-particles"
                   placeholder="Number of lines"
                   value="1000"/>
        </div>
    </div>

    <div class="row mb-3">
        <div class="col-4">
            <strong>Line flow</strong><br/>
            <small>Decide in which direction the lines should flow.</small>
        </div>
        <div class="col-8">
            <select class="form-control" id="exampleFormControlSelect1">
                <option>Unidirectional down</option>
                <option>Unidirectional up</option>
                <option>Bidirectional</option>
            </select>
        </div>
    </div>

    <div class="row mb-3">
        <div class="col-4">
            <strong>Thickness</strong><br/>
            <small>Value is randomly chosen between lower and upper bounds for each line.</small>
        </div>
        <div class="col-8">
            <div class="row">
                <div class="col">
                    Lowerbound:
                    <input type="number"
                           class="form-control"
                           id="setting-thickness-lowerbound"
                           placeholder="Number of lines"
                           value="1"/>
                </div>
                <div class="col">
                    Uppwerbound:
                    <input type="number"
                           class="form-control"
                           id="setting-thickness-upperbound"
                           placeholder="Number of lines"
                           value="5"/>
                </div>
            </div>
        </div>
    </div>

    <div class="row mb-3">
        <div class="col-4">
            <strong>Radius</strong><br/>
            <small>Maximum distance from center at which lines start, flow and end.</small>
        </div>
        <div class="col-8">
            <input type="number"
                   class="form-control"
                   id="setting-radius"
                   placeholder="Radius"
                   value="285"/>
        </div>
    </div>

    <div class="row mb-3">
        <div class="col-4">
            <strong>Complexity</strong><br/>
            <small></small>
        </div>
        <div class="col-8">
            <input type="number"
                   class="form-control"
                   id="setting-noise-zoom"
                   placeholder="Radius"
                   value="200"/>
        </div>
    </div>

    <div class="row mb-3">
        <div class="col-4">
            <strong>Edge feather</strong><br/>
            <small></small>
        </div>
        <div class="col-8">
            <input type="number"
                   class="form-control"
                   id="setting-edge-feather"
                   placeholder="Radius"
                   value="0"/>
        </div>
    </div>

</div>

<!-- 3rd party scripts -->
<script src="lib/jquery/index.js"></script>
<script src="lib/noisejs-master/perlin.js"></script>
<script src="lib/bootstrap-4.5.3-dist/js/bootstrap.min.js"></script>
<script src="lib/bootstrap-4.5.3-dist/js/bootstrap.bundle.min.js"></script>

<!-- Source JavaScript code -->
<script type="text/javascript">
    /*
     * Settings:
     * - n
     * - one sided / two sided
     * - Color scheme
     * - thickness: value / random between x and y
     * - background color
     * - seed: value or random
     * - radius
     * - noise zoom
     * - edge feather: none / chance
     */


    /** @var $ JQuery */
    $(document).ready(() => {
        test();
    });

    function test() {
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        const scale = 1;
        const width = 800 * scale;
        const height = 800 * scale;
        const n = 1000;

        canvas.width = width;
        canvas.height = height;

        ctx.fillStyle = '#000';
        ctx.fillRect(0, 0, width, height);

        const xCenter = width / 2;
        const yCenter = height / 2;
        const radius = width / 2.8;
        const noiseZoom = 200 * scale;
        let a, r, x, y, p;

        noise.seed(Math.random());

        // ctx.arc(xCenter, yCenter, radius * 1.05, 0, 2 * Math.PI);
        // ctx.strokeStyle = `rgba(102, 253, 255, 0.5)`;
        // ctx.lineWidth = 3 * scale;
        // ctx.stroke();

        // Why sqrt -> https://stackoverflow.com/questions/5837572/generate-a-random-point-within-a-circle-uniformly
        for (let i = 0; i < n; i++) {
            a = Random.uniform(0, 2 * Math.PI);
            r = Math.sqrt(Random.uniform(0, 1)) * radius;
            x = xCenter + (r * Math.cos(a));
            y = yCenter - (r * Math.sin(a));

            ctx.fillStyle = `rgba(0, ${ Random.uniform(0, 255) }, ${ Random.uniform(0, 255) }, 0.5)`;
            ctx.fillRect(x, y, 1, 1);

            let sign = Random.uniform(0, 1) >= 0.5 ? 1 : -1;
            sign = 1;
            const stroke = Random.uniform(scale, 8 * scale);

            while (inCircle(xCenter, yCenter, radius, x, y) || Random.uniform(0, 1) >= 1.1 * (1 / scale)) {
                p = noise.perlin2(x / noiseZoom, y / noiseZoom);
                x += Math.sin(p) * sign;
                y += Math.cos(p) * sign;

                ctx.fillRect(x, y, stroke, stroke);
            }
        }

        console.log('done');
    }

    const CircleGenerator = {};

    function inCircle(xCenter, yCenter, radius, xPoint, yPoint) {
        return Math.pow(xCenter - xPoint, 2) + Math.pow(yCenter - yPoint, 2) < Math.pow(radius, 2);
    }

    const Random = {
        uniform: function (min = 0.0, max = 1.0) {
            return min + Math.random() * (max - min);
        }
    };
</script>
</body>
</html>